<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ch√° de Casa Nova - Jennifer e Gabriel</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0f1115;
      --card-bg: #1e2229;
      --text: #edf2f7;
      --muted: #a0aec0;
      --border: #2d3748;
      --accent: #63b3ed;
      --accent-hover: #4299e1;
      --success: #48bb78;
      --btn-bg: #2d3748;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif; /* Fonte mais moderna pro corpo */
      color: var(--text);
      line-height: 1.6;

      /* SEU FUNDO AURORA */
      background-color: var(--bg);
      background-image: 
        radial-gradient(circle at 50% 0%, rgba(99, 179, 237, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 100% 0%, rgba(159, 122, 234, 0.1) 0%, transparent 40%);
      background-attachment: fixed;
    }

    main {
      max-width: 800px; /* Reduzi um pouco pra ficar mais 'intimista' */
      margin: 0 auto;
      padding: 24px 16px;
    }

    /* --- ESTILO DO T√çTULO --- */
    header {
      text-align: center;
      margin-bottom: 32px;
      padding-top: 10px;
    }

    .event-type {
      text-transform: uppercase;
      letter-spacing: 3px;
      font-size: 0.9rem;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 5px;
    }

    h1 {
      margin: 0;
      font-family: 'Great Vibes', cursive; /* Fonte manuscrita */
      font-size: 3.5rem; /* Tamanho grande pros nomes */
      font-weight: 400;
      background: linear-gradient(to right, #fff, #a5b4fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.1;
      text-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .subtitle {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 16px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* --- CARROSSEL DE FOTOS --- */
    .carousel-container {
      width: 100%;
      max-width: 500px; /* Largura m√°xima da foto */
      aspect-ratio: 4/3; /* Formato da foto (retangular) */
      margin: 0 auto 30px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 30px rgba(0,0,0,0.4);
      border: 1px solid var(--border);
      position: relative;
    }

    .carousel-track {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.6s ease-in-out;
    }

    .carousel-slide {
      min-width: 100%;
      height: 100%;
    }

    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover; /* Faz a imagem preencher tudo sem esticar */
    }

    /* --- RESTO DO DESIGN (IGUAL AO ANTERIOR) --- */
    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 24px;
      background: rgba(30, 34, 41, 0.6); /* Mais transl√∫cido */
      backdrop-filter: blur(10px); /* Efeito de vidro */
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    input[type="text"] {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.3);
      color: var(--text);
      flex: 1;
      min-width: 200px;
      font-size: 1rem;
    }
    input[type="text"]:focus { outline: none; border-color: var(--accent); }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.3); border-color: var(--accent); }
    .card-content { padding: 20px; flex: 1; }
    .card-title { font-size: 1.25rem; font-weight: 700; margin: 0 0 12px; color: #fff; }
    .badge { display: inline-flex; padding: 4px 10px; border-radius: 6px; background: rgba(99, 179, 237, 0.15); color: var(--accent); font-size: 0.85rem; font-weight: 600; margin-bottom: 16px; border: 1px solid rgba(99, 179, 237, 0.2); }
    
    .link-group { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
    .link-btn { display: block; padding: 10px 14px; background: var(--btn-bg); color: var(--text); text-decoration: none; border-radius: 8px; font-size: 0.9rem; text-align: center; border: 1px solid transparent; transition: 0.2s;}
    .link-btn:hover { background: #3e4c63; }
    .link-btn span { opacity: 0.8; font-size: 0.8em; margin-left: 6px; }

    .card-actions { background: rgba(0,0,0,0.2); padding: 16px 20px; border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 12px; }
    .check-label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 500; color: var(--muted); user-select: none; }
    .check-label input { width: 18px; height: 18px; accent-color: var(--success); }
    .btn-save { width: 100%; padding: 10px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; background: var(--accent); color: #1a202c; transition: 0.2s; }
    .btn-save:hover { background: var(--accent-hover); }
    .btn-save:disabled { opacity: 0.6; cursor: not-allowed; }
    .who-info { font-size: 0.8rem; color: var(--muted); text-align: center; min-height: 1.2em; }
    #status { text-align: center; height: 24px; color: var(--accent); font-weight: 600; margin-bottom: 10px; }
  </style>
</head>
<body>
<main>
  
  <header>
    <div class="event-type">Ch√° de Casa Nova</div>
    <h1>Jennifer & Gabriel</h1>
    
    <div class="carousel-container">
      <div class="carousel-track" id="track">
        
        <div class="carousel-slide">
          <img src="https://images.unsplash.com/photo-1517260739337-6799d239ce83?q=80&w=800&auto=format&fit=crop" alt="Foto 1">
        </div>
        
        <div class="carousel-slide">
          <img src="https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?q=80&w=800&auto=format&fit=crop" alt="Foto 2">
        </div>

        <div class="carousel-slide">
          <img src="https://images.unsplash.com/photo-1583847268964-b28dc8f51f92?q=80&w=800&auto=format&fit=crop" alt="Foto 3">
        </div>

      </div>
    </div>
    <p class="subtitle">
      Estamos montando nosso cantinho! Selecione um item abaixo para nos presentear.
      <br><small style="opacity: 0.7">(Sua marca√ß√£o √© salva automaticamente na nossa lista)</small>
    </p>
  </header>

  <div class="controls">
    <input id="who" type="text" placeholder="Seu nome (Opcional)" />
    <button id="reload" class="btn-save" style="width: auto; padding: 0 20px; background: var(--btn-bg); color: #fff;">üîÑ Atualizar</button>
  </div>

  <p id="status"></p>
  <section id="grid" class="grid"></section>
</main>

<script>
  // --- L√ìGICA DO CARROSSEL ---
  const track = document.getElementById('track');
  const slides = document.querySelectorAll('.carousel-slide');
  let index = 0;

  function nextSlide() {
    index++;
    if(index >= slides.length) index = 0;
    // Move o trilho para a esquerda
    track.style.transform = `translateX(-${index * 100}%)`;
  }
  // Muda de foto a cada 3.5 segundos
  setInterval(nextSlide, 3500);


  // --- L√ìGICA DA LISTA (Google Sheets) ---
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyIhUdiPCGg-j3Jg2qZeh6B4hJHmujyrohinPi4MGapfiwWaGD2rcqm1WUaY9xnq1b2/exec";

  const grid = document.getElementById("grid");
  const statusEl = document.getElementById("status");
  const whoEl = document.getElementById("who");
  document.getElementById("reload").onclick = load;

  function setStatus(msg){ statusEl.textContent = msg || ""; }

  async function load(){
    setStatus("Buscando presentes...");
    grid.innerHTML = "";
    try{
      const r = await fetch(WEB_APP_URL, { cache: "no-store" });
      const j = await r.json();
      if(!j.ok) throw new Error(j.error || "Falha ao carregar");
      render(j.items || []);
      setStatus("");
    }catch(e){
      setStatus("Ops: " + e.message);
    }
  }

  function formatQuem(item){
    if(item.status !== "ok") return "";
    const who = (item.quem || "").trim();
    if(!who) return "Item j√° reservado! ‚úÖ";
    return "Reservado por: " + who + " ‚úÖ";
  }

  function makeLinkBtn(link, label, isSecondary){
    if(!link) return "";
    const text = label || "Ver na Loja";
    const icon = isSecondary ? "üîó" : "üéÅ"; 
    return `<a href="${link}" class="link-btn" target="_blank" rel="noopener">${icon} ${text} <span>‚Üó</span></a>`;
  }

  function render(items){
    items.forEach(item => {
      const card = document.createElement("article");
      card.className = "card";
      
      if(item.status === 'ok') {
        card.style.opacity = "0.75";
        card.style.borderColor = "var(--success)";
      }

      const content = document.createElement("div");
      content.className = "card-content";

      const title = document.createElement("h2");
      title.className = "card-title";
      title.textContent = item.titulo || ("Item " + item.id);
      content.appendChild(title);

      if(item.cor){
        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = "üé® Prefer√™ncia: " + item.cor;
        content.appendChild(badge);
      }

      const linkGroup = document.createElement("div");
      linkGroup.className = "link-group";
      linkGroup.innerHTML = 
        makeLinkBtn(item.link1, item.link2 ? "Op√ß√£o 1" : "Ver Op√ß√£o de Compra") +
        makeLinkBtn(item.link2, "Op√ß√£o 2", true);
      content.appendChild(linkGroup);

      const actions = document.createElement("div");
      actions.className = "card-actions";
      const label = document.createElement("label");
      label.className = "check-label";
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = (item.status === "ok");
      const spanText = document.createElement("span");
      spanText.textContent = cb.checked ? "J√° comprei este item!" : "Marcar como comprado";
      
      cb.addEventListener('change', () => {
        spanText.textContent = cb.checked ? "J√° comprei este item!" : "Marcar como comprado";
        if(cb.checked) spanText.style.color = "var(--success)";
        else spanText.style.color = "var(--muted)";
      });

      label.appendChild(cb);
      label.appendChild(spanText);
      const saveBtn = document.createElement("button");
      saveBtn.className = "btn-save";
      saveBtn.textContent = "Confirmar / Salvar";
      const whoInfo = document.createElement("div");
      whoInfo.className = "who-info";
      whoInfo.textContent = formatQuem(item);

      saveBtn.onclick = async () => {
        saveBtn.disabled = true;
        saveBtn.textContent = "Salvando...";
        try{
          const payload = {
            id: String(item.id),
            status: cb.checked ? "ok" : "",
            quem: (whoEl.value || "").trim()
          };
          const r = await fetch(WEB_APP_URL, { method: "POST", body: JSON.stringify(payload) });
          const j = await r.json();
          if(!j.ok) throw new Error(j.error || "Erro no servidor");
          item.status = payload.status;
          item.quem = payload.quem;
          whoInfo.textContent = formatQuem(item);
          saveBtn.textContent = "Sucesso! ‚úÖ";
          saveBtn.style.background = "var(--success)";
          if(item.status === 'ok') card.style.borderColor = "var(--success)";
          else card.style.borderColor = "var(--border)";
          setTimeout(() => {
            saveBtn.textContent = "Confirmar / Salvar";
            saveBtn.style.background = ""; 
            saveBtn.disabled = false;
          }, 2000);
        }catch(e){
          alert("Erro: " + e.message);
          saveBtn.textContent = "Tentar Novamente";
          saveBtn.disabled = false;
        }
      };

      actions.appendChild(label);
      actions.appendChild(saveBtn);
      actions.appendChild(whoInfo);
      card.appendChild(content);
      card.appendChild(actions);
      grid.appendChild(card);
    });
  }

  load();
</script>
</body>
</html>
