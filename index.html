<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ch√° de Casa Nova - Jennifer e Gabriel - Sugest√µes de Presente</title>
  <style>
    :root {
      /* Paleta de Cores Atualizada */
      --bg: #121418;           /* Fundo da p√°gina levemente mais escuro */
      --card-bg: #1e2229;      /* Fundo do cart√£o */
      --text: #edf2f7;         /* Texto principal */
      --muted: #a0aec0;        /* Texto secund√°rio */
      --border: #2d3748;       /* Bordas sutis */
      --accent: #63b3ed;       /* Azul claro para destaques */
      --accent-hover: #4299e1; /* Azul mais escuro para hover */
      --success: #48bb78;      /* Verde para sucesso/check */
      --btn-bg: #2d3748;       /* Fundo de bot√µes secund√°rios */
    }

    * { box-sizing: border-box; }

body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      line-height: 1.6;

      /* Configura√ß√£o do Fundo */
      background-color: var(--bg);
      background-image: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(255, 255, 255, 0.03) 10px,
        rgba(255, 255, 255, 0.03) 11px
      );
    }

    main {
      max-width: 1000px;
      margin: 0 auto;
      padding: 24px 16px;
    }

    /* Cabe√ßalho */
    header {
      text-align: center;
      margin-bottom: 32px;
    }

    h1 {
      margin: 0 0 12px;
      font-size: 1.75rem;
      background: linear-gradient(90deg, #63b3ed, #9f7aea); /* Gradiente sutil no texto */
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      color: var(--muted);
      font-size: 0.95rem;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Controles (Nome e Recarregar) */
    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 24px;
      background: var(--card-bg);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    input[type="text"] {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      flex: 1;
      min-width: 200px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* Grid de Cart√µes */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    /* O Cart√£o */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      position: relative;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
      border-color: var(--accent);
    }

    .card-content {
      padding: 20px;
      flex: 1; /* Empurra o rodap√© para baixo */
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin: 0 0 12px;
      color: #fff;
      line-height: 1.3;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 6px;
      background: rgba(99, 179, 237, 0.15);
      color: var(--accent);
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 16px;
      border: 1px solid rgba(99, 179, 237, 0.2);
    }

    /* Bot√µes de Link (Shopee, etc) */
    .link-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    .link-btn {
      display: block;
      padding: 10px 14px;
      background: var(--btn-bg);
      color: var(--text);
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.9rem;
      text-align: center;
      transition: background 0.2s;
      border: 1px solid transparent;
    }

    .link-btn:hover {
      background: #3e4c63;
      text-decoration: none;
    }

    .link-btn span {
      opacity: 0.8;
      font-size: 0.8em;
      margin-left: 6px;
    }

    /* √Årea de A√ß√£o (Rodap√© do Card) */
    .card-actions {
      background: rgba(0,0,0,0.2);
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .check-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-weight: 500;
      color: var(--muted);
      user-select: none;
    }

    .check-label input {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--success);
    }

    .check-label input:checked + span {
      color: var(--success);
      font-weight: bold;
    }

    .btn-save {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: var(--accent);
      color: #1a202c;
      transition: background 0.2s, transform 0.1s;
    }

    .btn-save:hover {
      background: var(--accent-hover);
    }

    .btn-save:active {
      transform: scale(0.98);
    }

    .btn-save:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      filter: grayscale(1);
    }

    .who-info {
      font-size: 0.8rem;
      color: var(--muted);
      text-align: center;
      min-height: 1.2em;
    }

    /* Status de carregamento */
    #status {
      text-align: center;
      height: 24px;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 10px;
    }

    /* Utilit√°rio */
    .hidden { display: none; }
  </style>
</head>
<body>
<main>
  <header>
    <h1>Ch√° de Casa Nova<br>Jennifer & Gabriel</h1>
    <p class="subtitle">
      Selecione um item abaixo para nos presentear. A lista √© atualizada automaticamente no Google Sheets.
      <br><small style="opacity: 0.7">(Dica: coloque seu nome antes de marcar)</small>
    </p>
  </header>

  <div class="controls">
    <input id="who" type="text" placeholder="Seu nome (Opcional)" />
    <button id="reload" class="btn-save" style="width: auto; padding: 0 20px; background: var(--btn-bg); color: #fff;">üîÑ Atualizar Lista</button>
  </div>

  <p id="status"></p>
  <section id="grid" class="grid"></section>
</main>

<script>
  // URL DO SEU SCRIPT (MANTIDA)
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyIhUdiPCGg-j3Jg2qZeh6B4hJHmujyrohinPi4MGapfiwWaGD2rcqm1WUaY9xnq1b2/exec";

  const grid = document.getElementById("grid");
  const statusEl = document.getElementById("status");
  const whoEl = document.getElementById("who");
  document.getElementById("reload").onclick = load;

  function setStatus(msg){ statusEl.textContent = msg || ""; }

  async function load(){
    setStatus("Carregando lista de presentes...");
    grid.innerHTML = "";
    try{
      const r = await fetch(WEB_APP_URL, { cache: "no-store" });
      const j = await r.json();
      if(!j.ok) throw new Error(j.error || "Falha ao carregar");
      render(j.items || []);
      setStatus("");
    }catch(e){
      setStatus("Erro de conex√£o: " + e.message);
    }
  }

  function formatQuem(item){
    if(item.status !== "ok") return "";
    const who = (item.quem || "").trim();
    if(!who) return "Item j√° reservado! ‚úÖ";
    return "Reservado por: " + who + " ‚úÖ";
  }

  // Gera bot√£o visualmente agrad√°vel para o link
  function makeLinkBtn(link, label, isSecondary){
    if(!link) return "";
    const text = label || "Ver na Loja";
    // √çcone simples baseado no contexto (s√≥ visual)
    const icon = isSecondary ? "üîó" : "üéÅ"; 
    return `<a href="${link}" class="link-btn" target="_blank" rel="noopener">${icon} ${text} <span>‚Üó</span></a>`;
  }

  function render(items){
    items.forEach(item => {
      const card = document.createElement("article");
      card.className = "card";
      
      // Se j√° estiver marcado, opcionalmente deixamos o card mais opaco
      if(item.status === 'ok') {
        card.style.opacity = "0.75";
        card.style.borderColor = "var(--success)";
      }

      // --- CONTE√öDO SUPERIOR ---
      const content = document.createElement("div");
      content.className = "card-content";

      const title = document.createElement("h2");
      title.className = "card-title";
      title.textContent = item.titulo || ("Item " + item.id);

      content.appendChild(title);

      if(item.cor){
        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = "üé® Prefer√™ncia: " + item.cor;
        content.appendChild(badge);
      }

      const linkGroup = document.createElement("div");
      linkGroup.className = "link-group";
      // Adiciona os links como bot√µes
      linkGroup.innerHTML = 
        makeLinkBtn(item.link1, item.link2 ? "Op√ß√£o 1" : "Ver Op√ß√£o de Compra") +
        makeLinkBtn(item.link2, "Op√ß√£o 2", true);
      
      content.appendChild(linkGroup);

      // --- √ÅREA DE A√á√ÉO INFERIOR ---
      const actions = document.createElement("div");
      actions.className = "card-actions";

      const label = document.createElement("label");
      label.className = "check-label";
      
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = (item.status === "ok");
      
      // Texto do checkbox muda dinamicamente
      const spanText = document.createElement("span");
      spanText.textContent = cb.checked ? "J√° comprei este item!" : "Marcar como comprado";
      
      // Evento para mudar texto visualmente na hora
      cb.addEventListener('change', () => {
        spanText.textContent = cb.checked ? "J√° comprei este item!" : "Marcar como comprado";
        if(cb.checked) spanText.style.color = "var(--success)";
        else spanText.style.color = "var(--muted)";
      });

      label.appendChild(cb);
      label.appendChild(spanText);

      const saveBtn = document.createElement("button");
      saveBtn.className = "btn-save";
      saveBtn.textContent = "Confirmar / Salvar";

      const whoInfo = document.createElement("div");
      whoInfo.className = "who-info";
      whoInfo.textContent = formatQuem(item);

      // L√≥gica de Salvar
      saveBtn.onclick = async () => {
        saveBtn.disabled = true;
        saveBtn.textContent = "Salvando...";
        
        try{
          const payload = {
            id: String(item.id),
            status: cb.checked ? "ok" : "",
            quem: (whoEl.value || "").trim()
          };
          
          const r = await fetch(WEB_APP_URL, {
            method: "POST",
            body: JSON.stringify(payload)
          });

          const j = await r.json();
          if(!j.ok) throw new Error(j.error || "Erro no servidor");

          // Atualiza dados locais
          item.status = payload.status;
          item.quem = payload.quem;
          
          whoInfo.textContent = formatQuem(item);
          
          // Feedback visual
          saveBtn.textContent = "Sucesso! ‚úÖ";
          saveBtn.style.background = "var(--success)";
          
          // Atualiza visual do card (borda verde se marcado)
          if(item.status === 'ok') card.style.borderColor = "var(--success)";
          else card.style.borderColor = "var(--border)";

          setTimeout(() => {
            saveBtn.textContent = "Confirmar / Salvar";
            saveBtn.style.background = ""; 
            saveBtn.disabled = false;
          }, 2000);

        }catch(e){
          alert("Erro ao salvar: " + e.message);
          saveBtn.textContent = "Tentar Novamente";
          saveBtn.disabled = false;
        }
      };

      actions.appendChild(label);
      actions.appendChild(saveBtn);
      actions.appendChild(whoInfo);

      card.appendChild(content);
      card.appendChild(actions);
      grid.appendChild(card);
    });
  }

  load();
</script>
</body>
</html>


